#!/usr/bin/env zsh

#==============================================================================
# Aliases Configuration - Cleaned and Optimized
#==============================================================================

# Check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

#------------------------------------------------------------------------------
# Core System Commands
#------------------------------------------------------------------------------

# Documentation
alias man='batman --paging always'                   # Use batman as man replacement
# Fallback: use \man for system man

# Network
alias wget='wget2'                   # Use wget2 if available

# Shell Management
#------------------------------------------------------------------------------
function reload() {
    # Clear functions and aliases to prevent duplication
    unalias -a 2>/dev/null || true
    unfunction '*' 2>/dev/null || true
    
    # Clear zinit cache and restart cleanly
    if [[ -n "$ZINIT_HOME" ]] && command -v zinit >/dev/null 2>&1; then
        zinit cclear 2>/dev/null || true
    fi
    
    # Restart zsh cleanly instead of just sourcing
    exec zsh
}

alias rl='reload'                   # Short alias for reload
alias c="clear && printf '\e[3J'"   # Clear terminal and scrollback buffer

# Editor
alias vi='vim'                       # Ensure vi points to vim

#------------------------------------------------------------------------------
# System Monitoring and Information
#------------------------------------------------------------------------------

# System monitoring
if command_exists btop; then
    alias top='btop'                 # Use btop for better system monitoring
fi

# System information
alias df='df -h'                     # Disk usage in human readable format
alias free='free -m'                 # Memory usage in MB (Linux only)
alias path='echo ${(F)path}'         # Show PATH entries, one per line
alias now='date +"%T"'               # Current time
alias nowdate='date +"%d-%m-%Y"'     # Current date
alias ports='netstat -tulanp'        # Show active ports

#------------------------------------------------------------------------------
# File Operations and Navigation
#------------------------------------------------------------------------------

# Directory Operations
alias mkdir='mkdir -p'               # Create parent directories as needed

# Enhanced file listing with lsd
if command_exists lsd; then
    # Remove any existing ls alias/function before defining new function
    unalias ls &>/dev/null || true
    unset -f ls &>/dev/null || true
    
    # Smart ls with git status only when in a git repo
    function ls() {
        if git rev-parse --is-inside-work-tree &>/dev/null; then
            lsd --long --git --config-file ~/.dotfiles/config/lsd/config.yaml "$@"
        else
            lsd --long --config-file ~/.dotfiles/config/lsd/config-nogit.yaml "$@"
        fi
    }
    alias tree='lsd --tree --depth=3 --config-file ~/.dotfiles/config/lsd/config.yaml'
elif command_exists gls; then
    # GNU ls fallback (macOS with coreutils)
    alias ls='gls -la --group-directories-first --color=always'
else
    # Basic ls fallback
    alias ls='ls -la'
fi

# Enhanced file viewing
if command_exists bat; then
    alias cat='bat'                   # Use bat for syntax highlighted file viewing
elif command_exists gcat; then
    alias cat='gcat'                  # GNU cat fallback
fi


# File comparison
alias diff='batdiff'  # Use batdiff for diffs
# Fallback: use \diff for system diff


#------------------------------------------------------------------------------
# Fuzzy Finding
#------------------------------------------------------------------------------

# Fuzzy file finder with preview (fzf)
# Using function instead of alias to avoid ZLE widget issues
unalias ff 2>/dev/null  # Remove any existing alias
ff() {
    local file
    file=$(eval "${FZF_DEFAULT_COMMAND:-find . -type f}" | FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS $FZF_CTRL_T_OPTS" fzf)
    
    if [[ -n "$file" ]]; then
        echo "$file"
    fi
}

#------------------------------------------------------------------------------
# System Administration
#------------------------------------------------------------------------------

# Elevated privileges
alias reboot='sudo reboot'
alias shutdown='sudo shutdown -h now'

#------------------------------------------------------------------------------
# Development and Version Control
#------------------------------------------------------------------------------

# Git Aliases
alias gst='git status'                         # git status
alias ga='git add'                             # git add
alias gaa='git add --all'                      # git add all files
alias gsw='git switch'                         # git switch (modern alternative to checkout)
alias gd='git diff'                            # git diff

# Additional custom git aliases
alias gcm='git commit -m'                      # git commit with message
alias gpl='git pull'                           # git pull
alias gpsh='git push'                          # git push
alias gbr='git branch'                         # git branch
alias gca='git commit --amend -m'             # git commit amend with message
alias grs='git restore --staged'               # unstage files
alias grsa='git restore --staged .'            # unstage all files

# AWS Profile Management
alias awswork='export AWS_PROFILE=swa'
alias awspersonal='export AWS_PROFILE=personal'
alias awsclear='unset AWS_PROFILE'

#------------------------------------------------------------------------------
# Dotfiles Management  
#------------------------------------------------------------------------------

# Dotfiles management (kept as aliases since they're simple wrappers)
alias dotup="$HOME/.dotfiles/scripts/dotup"              # Apply dotfiles
alias pullbrut='git -C ~/.dotfiles pull brut:~/.dotfiles main && ~/.dotfiles/scripts/dotup'

#------------------------------------------------------------------------------
# Entertainment and Visual
#------------------------------------------------------------------------------

alias fastfetch='$HOME/.dotfiles/config/fastfetch/fastfetch_wrapper.zsh'