#!/usr/bin/env bash

set -euo pipefail

readonly CONFIG=".config/dotbot/install.conf.yaml"
readonly DOTBOT_DIR="dotbot"
readonly DOTBOT_BIN="bin/dotbot"
readonly BASEDIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

cd "${BASEDIR}"

git -C "${DOTBOT_DIR}" submodule sync --quiet --recursive
git -C "${DOTBOT_DIR}" submodule update --init --recursive
"${BASEDIR}/${DOTBOT_DIR}/${DOTBOT_BIN}" \
  -d "${BASEDIR}" \
  -c "${CONFIG}" \
  "${@:-}"
