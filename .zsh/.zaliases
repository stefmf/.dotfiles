#!/usr/bin/env zsh

#==============================================================================
# Aliases Configuration - Cleaned and Optimized
#==============================================================================

#------------------------------------------------------------------------------
# Helper Functions
#------------------------------------------------------------------------------

# Check if a command exists
command_exists() {
    command -v "$1" >/dev/null 2>&1
}

#------------------------------------------------------------------------------
# Core System Commands
#------------------------------------------------------------------------------

# Documentation
alias man='tldr'                     # Use tldr instead of man for quick help

# Network
alias wget='wget2'                   # Use wget2 if available

# Shell Management
alias reload='source ~/.zshrc'      # Reload shell configuration
alias c="clear && printf '\e[3J'"   # Clear terminal and scrollback buffer

# Editor
alias vi='vim'                       # Ensure vi points to vim

#------------------------------------------------------------------------------
# System Monitoring and Information
#------------------------------------------------------------------------------

# System monitoring
if command_exists btop; then
    alias top='btop'                 # Use btop for better system monitoring
fi

# System information
alias df='df -h'                     # Disk usage in human readable format
alias free='free -m'                 # Memory usage in MB (Linux only)
alias path='echo ${(F)path}'         # Show PATH entries, one per line
alias now='date +"%T"'               # Current time
alias nowdate='date +"%d-%m-%Y"'     # Current date
alias ports='netstat -tulanp'        # Show active ports

#------------------------------------------------------------------------------
# File Operations and Navigation
#------------------------------------------------------------------------------

# Directory Operations
alias mkdir='mkdir -p'               # Create parent directories as needed

# Enhanced file listing with fallbacks
if command_exists eza; then
    # Modern file listing with git integration
    if [[ "$TERM" == "linux" ]]; then
        # Terminal mode (no icons)
        alias ls='eza -la --group-directories-first --color=always --git --classify --sort=modified --reverse --header'
        alias tree='eza --tree --all --level=3 --color=always'
    else
        # Full featured mode with icons
        alias ls='eza -la --group-directories-first --color=always --git --classify --sort=modified --reverse --header --icons'
        alias tree='eza --icons --tree --all --level=3 --color=always'
    fi
elif command_exists gls; then
    # GNU ls fallback (macOS with coreutils)
    alias ls='gls -la --group-directories-first --color=always'
else
    # Basic ls fallback
    alias ls='ls -la'
fi

# Enhanced file viewing
if command_exists bat; then
    alias cat='bat'                   # Use bat for syntax highlighted file viewing
elif command_exists gcat; then
    alias cat='gcat'                  # GNU cat fallback
fi

# File comparison
alias diff='delta --config ~/.dotfiles/.config/delta/deltarc'

# Grep with color
alias grep='grep --color=auto'

#------------------------------------------------------------------------------
# Fuzzy Finding
#------------------------------------------------------------------------------

# Fuzzy file finder with preview (fzf)
# Using function instead of alias to avoid ZLE widget issues
unalias ff 2>/dev/null  # Remove any existing alias
ff() {
    local file
    file=$(eval "${FZF_DEFAULT_COMMAND:-find . -type f}" | FZF_DEFAULT_OPTS="$FZF_DEFAULT_OPTS $FZF_CTRL_T_OPTS" fzf)
    
    if [[ -n "$file" ]]; then
        echo "$file"
    fi
}

#------------------------------------------------------------------------------
# System Administration
#------------------------------------------------------------------------------

# Elevated privileges
alias reboot='sudo reboot'
alias shutdown='sudo shutdown -h now'

#------------------------------------------------------------------------------
# Development and Version Control
#------------------------------------------------------------------------------

# Note: Git aliases are provided by Oh My Zsh git plugin
# Available: gst, ga, gcm, gco, gbr, gpsh, gpl, glg, etc.

# AWS Profile Management
alias awswork='export AWS_PROFILE=swa'
alias awspersonal='export AWS_PROFILE=personal'
alias awsclear='unset AWS_PROFILE'

#------------------------------------------------------------------------------
# Platform-Specific Configuration
#------------------------------------------------------------------------------

case "$OSTYPE" in
    darwin*)
        #----------------------------------------------------------------------
        # macOS Configuration
        #----------------------------------------------------------------------
        
        # Brewfile management
        alias brewdump='brew bundle dump --force --no-vscode --file ~/.dotfiles/.bootstrap/macos/Brewfile'
        
        # Source and execute GNU utilities setup
        source "$HOME/.dotfiles/helpers/setup_gnu_aliases"
        setup_gnu_aliases
        ;;
        
    linux-gnu*|linux-musl*)
        #----------------------------------------------------------------------
        # Linux Configuration  
        #----------------------------------------------------------------------
        
        # Package management handled by update helper script
        ;;
esac

#------------------------------------------------------------------------------
# Load Helper Functions
#------------------------------------------------------------------------------

# Source helper functions for interactive use
source "$HOME/.dotfiles/helpers/source_functions"

#------------------------------------------------------------------------------
# Dotfiles Management  
#------------------------------------------------------------------------------

# Dotfiles management (kept as aliases since they're simple wrappers)
alias dotup="$HOME/.dotfiles/helpers/dotup"              # Apply dotfiles
alias pullbrut='git -C ~/.dotfiles pull brut:~/.dotfiles main && ~/.dotfiles/helpers/dotup'

#------------------------------------------------------------------------------
# Entertainment and Visual
#------------------------------------------------------------------------------

alias fastfetch='$HOME/.dotfiles/.config/fastfetch/fastfetch_wrapper.zsh'